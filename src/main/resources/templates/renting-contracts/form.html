<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<!--/*@thymesVar id="rentingContractVO" type="com.proskurnia.VOs.RentingContractVO"*/-->
<head>
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1"/>
    <title th:text="#{renting.contract}">Title</title>
    <th:block th:replace="template :: css"></th:block>
</head>
<body>
<div th:replace="template :: header"/>
<form th:object="${rentingContractVO}" th:action="@{save}" action="#" method="post">
    <div class="container">
        <input type="hidden" th:field="*{id}"/>
        <input type="hidden" th:field="*{tenantId}"/>
        <div class="form-group col-sm-6">
            <label th:text="#{tenant}"></label>
            <input class="form-control" th:field="*{tenantName}" readonly="true"/>
        </div>
        <div class="form-group col-sm-6">
            <label th:text="#{address}"></label>
            <select th:if="${rentingContractVO.id==0}" data-live-search="true" class="form-control selectpicker"
                    id="building">
                <th:block th:each="building : ${buildings}">
                    <option th:value="${building.key}" th:text="${building.value}"></option>
                </th:block>
            </select>
            <input class="form-control" th:field="*{address}" th:unless="${rentingContractVO.id==0}"
                   th:readonly="true"/>
        </div>
        <div class="form-group col-sm-6">
            <label th:text="#{room.number}"></label>
            <select th:if="${rentingContractVO.id==0}" data-live-search="true" class="form-control selectpicker"
                    th:field="*{apartmentId}">
            </select>
            <input type="hidden" th:field="*{apartmentId}"/>
            <input th:unless="${rentingContractVO==0}" class="form-control" th:field="*{roomNumber}"/>
        </div>
        <div class="form-group col-sm-6">
            <label th:text="#{rent.price}"></label>
            <div class="alert-danger" th:errors="*{rentPrice}"/>
            <input class="form-control" th:readonly="${rentingContractVO.id!=0}" th:field="*{rentPrice}"/>
        </div>
        <div class="form-group col-sm-6">
            <label th:text="#{estimated.fees}"></label>
            <div class="alert-danger" th:errors="*{estimatedFees}"/>
            <input class="form-control" th:field="*{estimatedFees}"/>
        </div>
        <div class="form-group col-sm-6">
            <label th:text="#{deposit}"></label>
            <div class="alert-danger" th:errors="*{deposit}"/>
            <a id="return-deposit" th:href="'/renting-contracts/return-deposit/'+${rentingContractVO.id}"
               th:class="'pull-right btn btn-warning btn-xs' + ${rentingContractVO.actualEndDate!='' and !rentingContractVO.depositReturned}?' hidden':''"
               th:text="#{return.deposit}">
            </a>
            <input class="form-control" th:unless="${rentingContractVO.depositReturned}" th:field="*{deposit}"
                   th:readonly="${rentingContractVO.id!=0}"/>
            <input class="form-control" th:if="${rentingContractVO.depositReturned}"
                   th:value="#{deposit.returned} + ': ' + *{deposit}"/>
        </div>
        <div class="form-group col-sm-6">
            <label th:text="#{account.balance}"></label>
            <div class="alert-danger" th:errors="*{balance}"/>
            <input class="form-control" th:field="*{balance}" readonly="readonly"/>
        </div>
        <div class="form-group col-sm-6">
            <label th:text="#{start.date}"></label>
            <div class="alert-danger" th:errors="*{startDate}"/>
            <input type="hidden" th:field="*{startDate}"/>
            <input class="datepicker form-control" data-default="today" data-alt-field="#startDate"
                   th:readonly="${rentingContractVO.id!=0}"/>
        </div>
        <div class="form-group col-sm-6">
            <label th:text="#{expected.end.date}"></label>
            <div class="alert-danger" th:errors="*{expectedEndDate}"/>
            <input type="hidden" th:field="*{expectedEndDate}"/>
            <input class="datepicker form-control" data-alt-field="#expectedEndDate"
                   th:readonly="${rentingContractVO.id!=0}"/>
        </div>
        <div class="form-group col-sm-6">
            <label th:text="#{actual.end.date}"></label>
            <div class="alert-danger" th:errors="*{actualEndDate}"/>
            <a id="end-contract" class="pull-right btn btn-danger btn-xs"
               th:href="'/renting-contracts/end-contract/'+${rentingContractVO.id}"
               th:if="${rentingContractVO.actualEndDate==null and rentingContractVO.id!=0}"
               th:text="#{end.contract}"></a>
            <input th:field="*{actualEndDate}" class="form-control" th:readonly="true"/>
        </div>
        <th:block>
            <hr/>
            <div th:if="${#fields.hasGlobalErrors()}" th:each="error : ${#fields.globalErrors()}">
                <div class="alert alert-danger" th:text="${error}"></div>
            </div>
            <div class="footer">
                <a th:href="'/payments/credit/'+${rentingContractVO.id}+'?address='+${rentingContractVO.address}+'&amp;roomNumber='+${rentingContractVO.roomNumber}"
                   th:unless="${rentingContractVO.id==0}" class="btn btn-primary"
                   th:text="#{register.credit.payment}"></a>
                <a th:href="'/reports/contract/'+${rentingContractVO.id}" th:unless="${rentingContractVO.id==0}"
                   class="btn btn-primary" th:text="#{view.report}"></a>
                <button th:if="${rentingContractVO.id==0}" type="submit" class="pull-right btn btn-success"
                        th:text="#{save}">Save
                </button>
            </div>
        </th:block>
    </div>
</form>
<th:block th:replace="template :: js"></th:block>
<script th:if="${rentingContractVO.id==0}">
    $('#building').change(function () {
        $.get("/apartments/json", {buildingId: $('#building').val()}, function (data) {
            $('#apartmentId').selectpicker('destroy').html(data.map(function (ap) {
                return $('<option value="' + ap.id + '">' + ap.roomNumber + '</option>')
            })).selectpicker();
        });
    }).change();
</script>
</body>
</html>